{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "One Piece TCG Card",
  "type": "object",
  "required": ["id", "set", "number", "name", "category", "colors", "types", "stats"],
  "properties": {
    "id": { "type": "string" },
    "set": { "type": "string" },
    "number": { "type": "integer" },
    "name": { "type": "string" },
    "verified": { "type": ["boolean", "null"] },
    "category": { "enum": ["Leader", "Character", "Event", "Stage", "Don"] },
    "colors": { "type": "array", "items": { "type": "string" } },
    "attribute": { "type": ["string", "null"] },
    "types": { "type": "array", "items": { "type": "string" } },
    "rarity": { "type": ["string", "null"] },
    "art": { "type": ["string", "null"] },
    "stats": {
      "type": "object",
      "properties": {
        "cost": { "type": ["integer", "null"] },
        "power": { "type": ["integer", "null"] },
        "life": { "type": ["integer", "null"] },
        "counter": {
          "type": "object",
          "properties": {
            "present": { "type": "boolean" },
            "value": { "type": "integer" }
          },
          "required": ["present", "value"]
        }
      },
      "required": ["cost", "power", "life", "counter"]
    },
    "keywords": { "type": "array", "items": { "type": "string" } },
    "trigger": {
      "type": ["object", "null"],
      "properties": { "text": { "type": "string" } },
      "required": ["text"]
    },
    "text": { "type": ["string", "null"] },
    "abilities": {
      "type": "array",
      "description": "Array of card abilities that can be activated or are continuous effects",
      "items": {
        "type": "object",
        "properties": {
          "type": { 
            "type": "string",
            "enum": [
              "On Play",
              "Activate Main",
              "On Attack",
              "On Block",
              "Blocker",
              "Rush",
              "Double Attack",
              "Critical",
              "Counter",
              "On KO",
              "End of Turn",
              "Trigger",
              "Opponents Turn",
              "Continuous"
            ],
            "description": "Canonical ability types. Use exactly these labels in JSON."
          },
            "autoResolve": {
              "type": ["boolean", "null"],
              "description": "If false, do not auto-resolve this ability when its timing occurs (e.g., optional On Play). Defaults to true for auto-timed abilities."
            },
          "frequency": { 
            "type": ["string", "null"],
            "enum": ["Once Per Turn", null],
            "description": "Frequency restriction: 'Once Per Turn' or null for unlimited"
          },
          "condition": {
            "type": ["object", "null"],
            "description": "Conditions that must be met for ability to activate",
            "properties": {
              "don": {
                "type": ["integer", "null"],
                "description": "Number of DON!! that must be attached to this card (e.g., 1 for 'DON!! x1')"
              },
              "yourTurn": {
                "type": ["boolean", "null"],
                "description": "Must be during your turn"
              },
              "opponentTurn": {
                "type": ["boolean", "null"],
                "description": "Must be during opponent's turn"
              },
              "leaderHasType": {
                "type": ["string", "null"],
                "description": "Controller's Leader must include this type (e.g., 'Red Hair Pirates')"
              }
            }
          },
          "cost": {
            "type": ["object", "null"],
            "description": "Cost to activate the ability (for manual activation abilities)",
            "properties": {
              "restThis": {
                "type": ["boolean", "null"],
                "description": "Must rest this card to activate"
              },
              "restDon": {
                "type": ["integer", "null"],
                "description": "Number of DON!! from cost area that must be rested"
              },
              "trash": {
                "type": ["integer", "null"],
                "description": "Number of cards to trash from hand"
              },
              "returnThisToDeck": {
                "type": ["string", "null"],
                "enum": ["top", "bottom", "shuffle", null],
                "description": "Return this card to deck as part of the cost"
              },
              "trashThis": {
                "type": ["boolean", "null"],
                "description": "Trash this card as part of the cost"
              },
              "discardFromLife": {
                "type": ["integer", "null"],
                "description": "Discard X cards from life as part of the cost"
              },
              "payLife": {
                "type": ["integer", "null"],
                "description": "Pay X life as part of the cost"
              }
            }
          },
          "effect": {
            "type": ["string", "object"],
            "description": "The effect that occurs. Can be a simple string description or structured object for complex effects",
            "properties": {
              "text": {
                "type": "string",
                "description": "Human-readable description of the effect"
              },
              "actions": {
                "type": ["array", "null"],
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["draw", "ko", "powerMod", "search", "addDon", "giveDon", "play", "return", "rest", "active", "grantKeyword", "disableKeyword"],
                      "description": "Action type"
                    },
                          "mode": { "type": ["string", "null"], "enum": ["normal", "aura", null], "description": "Execution mode: 'aura' for passive continuous effects applied dynamically while source remains on field" },
                    "targetSide": { "type": ["string", "null"], "enum": ["player", "opponent", "both", null] },
                    "targetType": { "type": ["string", "null"], "enum": ["leader", "character", "don", "any", null] },
                    "minTargets": { "type": ["integer", "null"] },
                    "maxTargets": { "type": ["integer", "null"] },

                    "amount": { "type": ["integer", "null"], "description": "Power change amount" },
                    "duration": { "type": ["string", "null"], "enum": ["thisTurn", "untilEndOfBattle", "untilOpponentsNextTurn", "permanent", null] },
                    "powerLimit": { "type": ["integer", "null"] },
                    "costLimit": { "type": ["integer", "null"] },

                    "quantity": { "type": ["integer", "null"] },

                    "lookCount": { "type": ["integer", "null"] },
                    "minSelect": { "type": ["integer", "null"] },
                    "maxSelect": { "type": ["integer", "null"] },
                    "destination": { "type": ["string", "null"], "enum": ["hand", "deck", "trash", "field", null] },
                    "remainderLocation": { "type": ["string", "null"], "enum": ["top", "bottom", "shuffle", null] },
                    "remainderOrder": { "type": ["string", "null"], "enum": ["any", "same", null] },
                    "filterType": { "type": ["string", "null"] },
                    "filterColor": { "type": ["string", "null"] },
                    "filterAttribute": { "type": ["string", "null"] },
                    "keyword": { "type": ["string", "null"], "description": "Keyword to grant (e.g., 'Rush', 'Blocker')" },
                    "targetSelf": { "type": ["boolean", "null"], "description": "If true, apply to the action source card instead of selecting targets" },
                    "onlyRested": { "type": ["boolean", "null"], "description": "For giveDon: whether to only use rested DON!! from cost area (default: true)" }
                  },
                  "required": ["type"]
                }
              }
            }
          }
        },
        "required": ["type", "effect"]
      }
    },
    "meta": {
      "type": "object",
      "properties": {
        "notes": { "type": ["string", "null"] }
      },
      "required": ["notes"]
    }
  }
}
